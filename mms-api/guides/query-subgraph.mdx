---
title: 'Query the subgraph'
description: 'Exact schema and working queries for books, depth, and your orders.'
---

The subgraph exposes typed entities. Below are working examples aligned with the schema.

<Note>
  **Important schema changes**: - `OpenOrder` entity renamed to `Order` -
  `openOrders` field renamed to `orders` - Orders are **never deleted** from the
  subgraph - Use `pendingUnitAmount_gt: "0"` to find all active orders
  (recommended) - `pendingUnitAmount` = sum of `claimableUnitAmount` +
  `cancelableUnitAmount` - New `Cancel` entity tracks all cancellation events -
  New `OrderMovement` interface allows querying takes, claims, and cancels
  together
</Note>

### Books (paginate)

```graphql
query Books($first: Int!, $skip: Int!) {
  books(first: $first, skip: $skip, orderBy: id) {
    id
    base {
      id
      symbol
      decimals
    }
    quote {
      id
      symbol
      decimals
    }
    unitSize
    makerPolicy {
      fee
      isFeeInQuote
    }
    takerPolicy {
      fee
      isFeeInQuote
    }
  }
}
```

### Depth by price level

```graphql
query Depth($book: ID!, $first: Int!) {
  book(id: $book) {
    id
    depths(first: $first, orderBy: tick, orderDirection: desc) {
      tick
      unitAmount
      baseAmount
      quoteAmount
    }
  }
}
```

### Orders for a user in a book

Query all orders for a user. Filter by `pendingUnitAmount` to find active orders.

```graphql
query MyOrdersInBook($owner: Bytes!, $book: ID!) {
  orders(
    where: { owner: $owner, book: $book }
    orderBy: tick
    orderDirection: desc
  ) {
    id
    orderIndex
    tick
    unitAmount
    pendingUnitAmount
    claimableUnitAmount
    cancelableUnitAmount
    timestamp
  }
}
```

### Active orders (all pending orders)

Use `pendingUnitAmount` to filter for all orders that are either claimable or still in the book.

```graphql
query MyActiveOrders($owner: Bytes!, $book: ID!) {
  orders(
    where: { owner: $owner, book: $book, pendingUnitAmount_gt: "0" }
    orderBy: tick
    orderDirection: desc
  ) {
    id
    tick
    pendingUnitAmount
    pendingBaseAmount
    pendingQuoteAmount
    claimableUnitAmount
    cancelableUnitAmount
    timestamp
  }
}
```

### Orders with claimable amounts only

```graphql
query MyClaimableOrders($owner: Bytes!, $book: ID!) {
  orders(
    where: { owner: $owner, book: $book, claimableUnitAmount_gt: "0" }
    orderBy: tick
    orderDirection: desc
  ) {
    id
    tick
    claimableUnitAmount
    claimableBaseAmount
    claimableQuoteAmount
    timestamp
  }
}
```

### Orders that can be canceled

```graphql
query MyCancelableOrders($owner: Bytes!, $book: ID!) {
  orders(
    where: { owner: $owner, book: $book, cancelableUnitAmount_gt: "0" }
    orderBy: tick
    orderDirection: desc
  ) {
    id
    tick
    cancelableUnitAmount
    cancelableBaseAmount
    cancelableQuoteAmount
    timestamp
  }
}
```

### Recent taker trades (takes) in a book

```graphql
query RecentTakes($book: ID!, $first: Int!) {
  takes(
    where: { book: $book }
    first: $first
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    timestamp
    trader
    inputToken {
      id
      symbol
    }
    outputToken {
      id
      symbol
    }
    inputAmount
    outputAmount
    amountUSD
    transaction {
      id
    }
  }
}
```

### Order details with fills, claims, and cancels

```graphql
query OrderDetails($orderId: ID!) {
  order(id: $orderId) {
    id
    tick
    price
    unitAmount
    filledUnitAmount
    claimedUnitAmount
    claimableUnitAmount
    cancelableUnitAmount
    pendingUnitAmount
    fills(orderBy: timestamp, orderDirection: asc) {
      id
      timestamp
      fillIndex
      inputAmount
      outputAmount
      amountUSD
      transaction {
        id
      }
    }
    claims(orderBy: timestamp, orderDirection: asc) {
      id
      timestamp
      claimer
      claimedUnitAmount
      claimedQuoteAmount
      transaction {
        id
      }
    }
    cancels(orderBy: timestamp, orderDirection: asc) {
      id
      timestamp
      canceller
      canceledUnitAmount
      canceledQuoteAmount
      transaction {
        id
      }
    }
  }
}
```

### Maker fills for a user across all books

```graphql
query MakerFillsByUser($maker: Bytes!, $first: Int!) {
  makerFills(
    where: { maker: $maker }
    first: $first
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    timestamp
    book {
      id
      base {
        symbol
      }
      quote {
        symbol
      }
    }
    tick
    price
    inputAmount
    outputAmount
    amountUSD
    orderIdString
  }
}
```

### All trades for a given user in a book

```graphql
query UserTradesInBook($user: Bytes!, $book: ID!, $first: Int!) {
  trades(
    where: { trader: $user, book: $book }
    first: $first
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    type
    timestamp
    trader
    book {
      id
    }
    inputToken {
      id
      symbol
    }
    outputToken {
      id
      symbol
    }
    inputAmount
    outputAmount
    amountUSD
    logIndex
    transaction {
      id
    }
  }
}
```

### Cancels for a specific order

```graphql
query OrderCancels($orderId: ID!) {
  order(id: $orderId) {
    id
    tick
    price
    cancels(orderBy: timestamp, orderDirection: asc) {
      id
      timestamp
      canceller
      owner
      canceledUnitAmount
      canceledBaseAmount
      canceledQuoteAmount
      canceledAmountUSD
      remainingClaimableUnitAmount
      remainingCancelableUnitAmount
      transaction {
        id
      }
    }
  }
}
```

### Claims by owner across all books

```graphql
query ClaimsByOwner($owner: Bytes!, $first: Int!) {
  claims(
    where: { owner: $owner }
    first: $first
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    timestamp
    book {
      id
      base {
        symbol
      }
      quote {
        symbol
      }
    }
    claimer
    orderIdString
    tick
    price
    claimedUnitAmount
    claimedBaseAmount
    claimedQuoteAmount
    claimedAmountUSD
    transaction {
      id
    }
  }
}
```

### Cancels by owner across all books

```graphql
query CancelsByOwner($owner: Bytes!, $first: Int!) {
  cancels(
    where: { owner: $owner }
    first: $first
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    timestamp
    book {
      id
      base {
        symbol
      }
      quote {
        symbol
      }
    }
    canceller
    orderIdString
    tick
    price
    canceledUnitAmount
    canceledBaseAmount
    canceledQuoteAmount
    canceledAmountUSD
    transaction {
      id
    }
  }
}
```

### All order movements (takes, claims, cancels) for a user

Using the `OrderMovement` interface to query all order movements:

```graphql
query UserOrderMovements($trader: Bytes!, $book: ID!, $first: Int!) {
  orderMovements(
    where: { trader: $trader, book: $book }
    first: $first
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    type
    timestamp
    trader
    book {
      id
    }
    logIndex
    transaction {
      id
    }
    ... on Take {
      inputToken {
        symbol
      }
      outputToken {
        symbol
      }
      inputAmount
      outputAmount
    }
    ... on Claim {
      orderIdString
      claimedUnitAmount
      claimedQuoteAmount
    }
    ... on Cancel {
      orderIdString
      canceledUnitAmount
      canceledQuoteAmount
    }
  }
}
```
